<!DOCTYPE html>
<html lang="en">
<head>
    @@include('../../partical/meta.inc',{"title":"社区首页"})
    @@include('../../partical/styles.inc', {"links":"" })
    <link rel="stylesheet" href="../../assets/styles/app.css">
    @@include('../../partical/fontsize.inc')
</head>
<body>
<!--头部-->
<div class="header-fixed jm-shop-header jm-header-column-two-right shop-community-index-head " >
    <div class="jm-wrapper un-bottom-line">
        <div class="header-left-box">
            <a href=""><i class=""></i></a>
        </div>
        <div class="header-center-box mid-search">
            <div class="search-box">
                <form action="#" method="" class="search-form">
                    <div class="inner-box">
                        <input type="search" name="search-form-content" placeholder="输入搜索内容" autocomplete="off" class="search-form-item">
                        <button type="submit" class="search-sub-btn"><i class="icon_header_commu_search"></i></button>
                        <i class="icon_header_shop_search_cancel"></i>
                    </div>
                </form>
            </div>
        </div>
        <div class="header-right-box">
            <a  href="#" style="display: block"><i class="icon-r show  icon_header_commu_plus"></i></a>
        </div>
    </div>
</div>
<!--如果布局fixed，将占据垂直空间1.26rem-->
<div class="hold-space-top"></div>
<!--body内容信息-->
<div id="content" class="page-content shop-community-index">
    <div class="nav-index-box mrg-bottom24">
        <ul class="main-nav">
            <a href="#"><li class="nav-type-item current"><span>推荐</span></li></a>
            <a href="#"><li class="nav-type-item"><span>饮食</span></li></a>
            <a href="#"><li class="nav-type-item"><span>限时特惠</span></li></a>
            <a href="#"><li class="nav-type-item"><span>美妆</span></li></a>
            <a href="#"><li class="nav-type-item"><span>母婴</span></li></a>
            <a href="#"><li class="nav-type-item"><span>出行</span></li></a>
            <a href="#"><li class="nav-type-item"><span>美食</span></li></a>
            <a href="#"><li class="nav-type-item"><span>游乐</span></li></a>
        </ul>
        <span class="nav-arrow-box">
            <i class="arrow"></i>
        </span>
    </div>
    <!--广告宣传-->
    <div class="shop-community-index-banner">
        <div class="swiper-container swiper-container-banner">
            <div class="swiper-wrapper">
                <a
                        class="swiper-slide swiper-slide-active" href="javascript:void(0);"><img
                        src="../../assets/images/app/bbs/banner.png"></a>
                <a
                        class="swiper-slide swiper-slide-active" href="javascript:void(0);"><img
                        src="../../assets/images/app/bbs/banner2.png"></a>

            </div>
            <div class="swiper-pagination"></div>
        </div>
    </div>
    <div class="recommend-title">
        <div class="info-list-title">
        <span class="title-box">
<i class="common_icon_fix icon_order_title_sign"></i>           <span class="title">你可能感兴趣的圈子</span>
<i class="common_icon_fix icon_order_title_sign scalex"></i>
</span>
        </div>
        <!--<a href="#" class="more-btn">更多</a>-->
    </div>
    <!--品牌-->
    <div class="index-hobby-box mrg-bottom24">
        <div class="swiper-container swiper-container-hobby">
            <ul class="list swiper-wrapper">
                <li class="hobby-item item-box swiper-slide">
                    <a href="#">
                        <div class="inner">
                            <div class="item">
                                <div class="imgbox">
                                    <img src="../../assets/images/app/bbs/icon_bbs_nav_1.png" alt="美食饮料"/>
                                </div>
                            </div>
                            <p class="title">美食饮料</p>
                            <p class="desc">保持沁润水靓保持沁润保持沁润水靓保持沁润</p>
                            <span class="attention-btn">加入</span>
                        </div>
                    </a>
                </li>
                <li class="hobby-item item-box swiper-slide">
                    <a href="#">
                        <div class="inner">
                            <div class="item">
                                <div class="imgbox">
                                    <img src="../../assets/images/app/bbs/icon_bbs_nav_2.png" alt="出行旅行"/>
                                </div>
                            </div>
                            <p class="title">出行旅行</p>
                            <p class="desc">保持沁润水</p>
                            <span class="attention-btn">加入</span>
                        </div>
                    </a>
                </li>
                <li class="hobby-item item-box swiper-slide">
                    <a href="#">
                        <div class="inner">
                            <div class="item">
                                <div class="imgbox">
                                    <img src="../../assets/images/app/bbs/icon_bbs_nav_3.png" alt="装逼"/>
                                </div>
                            </div>
                            <p class="title">装逼</p>
                            <p class="desc">保持沁润水靓保持沁润保持沁润水靓保持沁润</p>
                            <span class="attention-btn">加入</span>
                        </div>
                    </a>
                </li>
                <li class="hobby-item item-box swiper-slide">
                    <a href="#">
                        <div class="inner">
                            <div class="item">
                                <div class="imgbox">
                                    <img src="../../assets/images/app/bbs/icon_bbs_nav_1.png" alt="美食饮料"/>
                                </div>
                            </div>
                            <p class="title">美食饮料</p>
                            <p class="desc">保持沁润水靓保持沁润保持沁润水靓保持沁润</p>
                            <span class="attention-btn">加入</span>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <!--热推产品-->
    <div class="index-community-hobby-new">
        <div id="container" class="waterfall">
            <ul class="inner-container clearfix" id="main">
                <li class="item">
                    <div class="item-container">
                        <a href="./community_detail.html">
                            <div class="imgbox">
                                <img src="../../assets/images/brand/1484592650148983443.jpg" alt="关注">
                            </div>
                            <p class="title">超实用！超实用！超实用干货攻略</p>
                            <p class="desc">超实用干货攻略超实用干货攻略描述描述超实用干货攻略超实用干货攻略描述描述</p>
                        </a>
                        <a class="commu-user clearfix">
                            <div class="imgbox">
                                <img src="../../assets/images/app/bbs/bbs_msg_dead_normal.png" alt="头像">
                            </div>
                            <span class="text">巴塞洛拉</span>
                        </a>

                        <a class="praise" href="#"><i class="icon_commu_heart mrg-r10"></i><span class="text">300</span></a>
                    </div>

                </li>
                <li class="item">
                    <div class="item-container">
                        <div href="./community_detail.html" class="clearfix">
                            <div class="imgbox">
                                <img src="../../assets/images/app/user/icon_user_track2.png" alt="关注">
                            </div>
                            <p class="title">超实用！超实用</p>
                            <p class="desc">44</p>
                        </div>
                        <div class="commu-user clearfix">
                            <div class="imgbox">
                                <img src="../../assets/images/app/bbs/bbs_msg_dead_normal.png" alt="头像">
                            </div>
                            <span class="text">巴塞洛拉</span>
                        </div>
                        <div class="praise clearfix" href="#"><i class="icon_commu_red_heart mrg-r10"></i><span class="text">300</span></div>
                    </div>

                </li>
                <li class="item">
                    <div class="item-container">
                        <a href="./community_detail.html">
                            <div class="imgbox">
                                <img src="../../assets/images/brand/1484592650148983443.jpg" alt="关注">
                            </div>
                            <p class="title">超实用！超实用！超实用干货攻略</p>
                            <p class="desc">超实用干货攻略超实用干货攻略描述描述超实用干货攻略超实用干货攻略描述描述</p>
                        </a>
                        <a class="commu-user clearfix">
                            <div class="imgbox">
                                <img src="../../assets/images/app/bbs/bbs_msg_dead_normal.png" alt="头像">
                            </div>
                            <span class="text">巴塞洛拉</span>
                        </a>

                        <a class="praise" href="#"><i class="icon_commu_heart mrg-r10"></i><span class="text">300</span></a>
                    </div>

                </li>
                <li class="item">
                    <div class="item-container">
                        <a href="./community_detail.html">
                            <div class="imgbox">
                                <img src="../../assets/images/brand/1484592650148983443.jpg" alt="关注">
                            </div>
                            <p class="title">超实用！超实用！超实用干货攻略</p>
                            <p class="desc">超实用干货攻略超实用干货攻略描述描述超实用干货攻略超实用干货攻略描述描述</p>
                        </a>
                        <a class="commu-user clearfix">
                            <div class="imgbox">
                                <img src="../../assets/images/app/bbs/bbs_msg_dead_normal.png" alt="头像">
                            </div>
                            <span class="text">巴塞洛拉</span>
                        </a>
                        <a class="praise" href="#"><i class="icon_commu_heart mrg-r10"></i><span class="text">300</span></a>
                    </div>
                </li>
            </ul>
            <div style="height:1rem;"></div>
        </div>
    </div>
    <div class="mask">
        <ul class="nav-list clearfix">
            <li class="nav-item">饮食</li>
            <li class="nav-item">饮食</li>
            <li class="nav-item">美妆</li>
            <li class="nav-item">出行</li>
            <li class="nav-item">出行</li>
            <li class="nav-item">饮食</li>
            <li class="nav-item">饮食</li>
            <li class="nav-item">美妆</li>
            <li class="nav-item">出行</li>
            <li class="nav-item">出行</li>
            <li class="nav-item">饮食</li>
            <li class="nav-item">饮食</li>
            <li class="nav-item">美妆</li>
            <li class="nav-item">出行</li>
            <li class="nav-item">出行</li>
        </ul>
    </div>
</div>

<!--底部导航-->
@@include('../../partical/footer-shop-nav-bar-new.inc')
<link rel="stylesheet" href="../../assets/styles/community.css">
<script type="text/javascript">
  $(function () {
    var mySwiperbanner = new Swiper('.swiper-container-banner', {
      autoplay: 5000,
      direction: 'horizontal',
      loop: true,
      pagination: '.swiper-pagination',
      paginationClickable :true
    });

    var mySwiperhobby= new Swiper('.swiper-container-hobby', {
      freeMode : true,
      centeredSlides : false,
      slidesPerView : 3.6,
      paginationClickable :true,
      onTouchStart: function(swiper,even){
        swiper.unlockSwipeToPrev();
        swiper.unlockSwipeToNext();
        if(swiper.isEnd){
          swiper.lockSwipeToNext();
        }
        else if(swiper.activeIndex==0){
          swiper.lockSwipeToPrev();
        }
      }
    });

    $(".nav-arrow-box").on('click',function (e) {
      if($(this).find(".arrow").hasClass("open")){//打开的
        $(this).find(".arrow").removeClass("open");
        $(".mask").removeClass("open");
        $("body").css({"overflow":"auto"});
      }else{
        $(this).find(".arrow").addClass("open");
        $(".mask").addClass("open");
        $("body").css({"overflow":"hidden"});
      }
    });
    $(".mask").on('click',function (e) {
      $(".nav-arrow-box").find(".arrow").removeClass("open");
      $(".mask").removeClass("open");
      $("body").css({"overflow":"auto"});
    });
  })
</script>

<script type="text/javascript">
  var dataInt={'data':[
    {'src':'http://img4.imgtn.bdimg.com/it/u=3400595141,3957584367&fm=200&gp=0.jpg'},
    {'src':'http://pic41.nipic.com/20140501/18539861_155959517170_2.jpg'},
    {'src':'http://imgsrc.baidu.com/forum/pic/item/5d8ea144ad345982913052140cf431adcaef8455.jpg'},
    {'src':'http://img4.imgtn.bdimg.com/it/u=3400595141,3957584367&fm=200&gp=0.jpg'},
    {'src':'http://img17.3lian.com/d/file/201702/22/953c40c874029fb2b5dac1fd2540d327.jpg'},
    {'src':'http://pic.qiantucdn.com/58pic/17/91/72/51Z58PICNtg_1024.jpg'},
    {'src':'http://img0.imgtn.bdimg.com/it/u=1531392329,2869685141&fm=200&gp=0.jpg'},
    {'src':'http://img4.imgtn.bdimg.com/it/u=3400595141,3957584367&fm=200&gp=0.jpg'},
    {'src':'http://pic.qiantucdn.com/58pic/17/91/72/51Z58PICNtg_1024.jpg'}]
  };
  //当前图片是否加载完成
  var isLoadCompleted = true;
  var spaceTime = true;
  $( window ).on( "load", function(){
    waterfall();

    window.onscroll=function(){
      //console.log("isCompleted=="+isLoadCompleted +"  spaceTime=="+spaceTime);
      if(!isLoadCompleted && !spaceTime){
        console.log("isCompleted=="+isLoadCompleted);
        return;
      }
      //spaceTime = true;
      if(isLoadCompleted && spaceTime && checkscrollside()){
        /*$.ajax({
          type: "POST",
          url: "some.php",
          data: "name=John&location=Boston",
          success: function(data){
            waterFallHandler(data);
          }
        });*/
        
        isLoadCompleted = false;
        spaceTime = false;
        waterFallHandler();
      };
    }
  });

  //异步请求回调
  function waterFallHandler(data) {
    var $oMian =  $("#main") ;
    var html = temp(data);
    $oMian.append(html);
    //创建加载图片
    var oImg=document.createElement('img');
    //异步加载返回json数据
    var index = Math.floor(Math.random()*7);
    oImg.src=dataInt.data[index]['src'];
    oImg.style.opacity='0';
    oImg.style.height='0';
    $("#main .item").last().find(".tempimgbox").css({"padding-top":"50%"}).append(oImg);
    waterfall();
    //图片加载完成高度确定，重新排版位置
    oImg.onload = function(e){
      oImg.onload = null;
      $(e.target).parent(".tempimgbox").css({"padding-top":"0"});
      e.target.style.opacity='1';
      e.target.style.height='auto';

      waterfall();
      isLoadCompleted = true;
      spaceTime = true;
      clearTimeout(timer);
    };
    var timer = setTimeout(function() { //控制滑行手速，时间越长对速度的滑动时间影响越大。
      spaceTime = true;
    }, 200);
  }


  function waterfall(){
    var $aPin = $( "#main>.item" );
    var iPinW = $aPin.eq( 0 ).width();// 一个块框pin的宽
    var num = 2;//每行个数
    $( "#main" ).css({
      'width:' : iPinW * num,
      'margin': '0 auto'
    });

    var pinHArr=[];//用于存储 每列中的所有块框相加的高度。

    $aPin.each( function( index, value ){
      var pinH = $aPin.eq( index ).height();
      if( index < num ){
        pinHArr[ index ] = pinH; //第一行中的num个块框pin 先添加进数组pinHArr
      }else{
        var minH = Math.min.apply( null, pinHArr );//数组pinHArr中的最小值minH
        var minHIndex = $.inArray( minH, pinHArr );
        $( value ).css({
          'position': 'absolute',
          'top': minH + 0,
          'left': $aPin.eq( minHIndex ).position().left
        });
        //数组 最小高元素的高 + 添加上的aPin[i]块框高
        pinHArr[ minHIndex ] += $aPin.eq( index ).height() + 0;//更新添加了块框后的列高
      }
    });
    var max_height = pinHArr[0] > pinHArr[1] ? pinHArr[0]: pinHArr[1];
    $(".inner-container").height(max_height);
  }

  function checkscrollside(){
    /*var $aPin = $("#main > .item" );
    //var lastPinH = $aPin.last()[0].offsetTop + Math.floor($aPin.last().height()/2);//创建【触发添加块框函数waterfall()】的高度：最后一个块框的距离网页顶部+自身高的一半(实现未滚到底就开始加载)
    var scrollTop = $( window ).scrollTop()//注意解决兼容性
    var documentH = $( document ).height();//页面高度
    console.log("lastPinH=="+lastPinH+"   scrollTop="+scrollTop+"   documentH="+documentH);
    return (lastPinH < scrollTop + documentH ) ? true : false;//到达指定高度后 返回true，触发waterfall()函数*/
    console.log("$(window).scrollTop()= "+$(window).scrollTop());
    console.log("$(document).height()= "+$(document).height());
    console.log("$(window).height()= "+$(window).height());
    if ($(window).scrollTop() >= $(document).height() - $(window).height() - 20) {
      console.log("lastPinH==----true");
      return true;
    }else{
      console.log("lastPinH==----false");
      return false;
    }
  }

  //模板 传入json数据
  function temp(data) {
    var html = "";
    html = '<li class="item">' +
      '<div class="item-container">'+
      '<a href="./community_detail.html">'+
      '<div class="imgbox tempimgbox">'+
      '</div>'+
      '<p class="title">'+(111)+"超实用,超实用超实用,超实用超实用,超实用"+'</p>'+
      '<p class="desc">'+(44)+'</p>'+
      '</a>'+
      '<a class="commu-user clearfix">'+
      '<div class="imgbox">'+
      '<img src="../../assets/images/app/bbs/bbs_msg_dead_normal.png" alt="头像"/>'+
      '</div>'+
      '<span class="text">巴塞洛拉巴塞洛拉</span>'+
      '</a>'+
      '<a class="praise" href="#">' +
      '<i class="icon_commu_red_heart mrg-r10"></i>' +
      '<span class="text">300</span>' +
      '</a>'+
      '</div>' +
      '</li>';
    return html;
  }

</script>
</body>
</html>